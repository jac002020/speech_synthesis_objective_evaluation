%
% Evaluate our development set 2009 EH2 
%

local_conf

mapmethods={ {'fft','snr'},..
             {'straight','snr'},..
             {'fft','mcd'}, ...
             {'straight','mcd'},..
             {'llr','llr'}, ...
             {'fft','log-mel'},...
             {'straight','log-mel'}};


if (matlabpool('size') == 0)
    matlabpool
end

tests={ ...
    struct( ...
        'name',                  'EH2_similarity',...
        'objective_resultfile',  'devel/2009_EH2_objective_results_sim',...
        'testfilelist',          'devel/2009_EH2_sim.ref.scp',...
        'reffilelist',           'devel/2009_EH2_sim.test.scp',...
        'subjective_resultfile', 'blizzard_tests/2009_subjective_eval_sim_means_only_num.txt',...
        'opinionmatrix',         'blizzard_tests/2009_simrefEH2.ascii',...
        'systems',               'BCDEHIJKLMOPQRSTUW', ...
        'results',                []), ...
    struct( ...
        'name',                  'EH2_naturalness',...
        'objective_resultfile',  'devel/2009_EH2_objective_results_nat',...
        'testfilelist',          'devel/2009_EH2_nat.ref.scp',...
        'reffilelist',           'devel/2009_EH2_nat.test.scp',...
        'subjective_resultfile', 'blizzard_tests/2009_subjective_eval_nat_means_only_num.txt',...
        'opinionmatrix',         'blizzard_tests/2009_natrefEH2.ascii',...
        'systems',               'BCDEHIJKLMOPQRSTUW', ...
        'results',                []) ...
    };


    
for n=1:length(tests)
    if exist(tests{n}.objective_resultfile, 'file') == 0;
        [ sim_averagedist, b2009_EH2_sim_distlist, sim_runtime ] = ...
            obj_evaluation(BLIZZARD2009_RESULTDIR, ...
                           tests{n}.reffilelist,tests{n}.testfilelist, mapmethods);
        
        save(simfile,tests{n}.objective_resultfile,'-ascii');
    end
    
    objdata=load(tests{n}.objective_resultfile);
    subjectivedata=load(tests{n}.subjective_resultfile);
    opinionmat= load(tests{n}.opinionmatrix);
    
    tests{n}.results=evaluate_wilcoxon(objdata, subjectivedata, opinionmat, ...
                               'BCDEHIJKLMOPQRSTUW');
end

