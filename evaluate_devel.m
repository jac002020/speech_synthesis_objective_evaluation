%
% Evaluate our development set 2009 EH2 
%

local_conf

mapmethods={ {'fft','snr'},...
             {'straight','snr'},...
             {'fft','mcd'}, ...
             {'straight','mcd'},...
             {'llr','llr'}, ...
             {'fft','log-mel'},...
             {'straight','log-mel'}};


if (matlabpool('size') == 0)
    matlabpool
end

dtests={ ...
    struct( ...
        'name',                  'EH2_similarity',...
        'objective_resultfile',  'devel/2009_EH2_objective_results_sim',...
        'testfilelist',          'devel/2009_EH2_sim.ref.scp',...
        'reffilelist',           'devel/2009_EH2_sim.test.scp',...
        'subjective_resultfile', 'devel/2009_EH2_sim_mean.ascii',...
        'opinionmatrix',         'blizzard_tests/significancematrix_2009_EH2_sim.ascii',...
        'systems',               'BCDEHIJKLMOPQRSTUW', ...
        'results',                []), ...
    struct( ...
        'name',                  'EH2_naturalness',...
        'objective_resultfile',  'devel/2009_EH2_objective_results_nat',...
        'testfilelist',          'devel/2009_EH2_nat.ref.scp',...
        'reffilelist',           'devel/2009_EH2_nat.test.scp',...
        'subjective_resultfile', 'devel/2009_EH2_sim_mean.ascii',...
        'opinionmatrix',         'blizzard_tests/significancematrix_2009_EH2_nat.ascii',...
        'systems',               'BCDEHIJKLMOPQRSTUW', ...
        'results',                []) ...
    };


    

    
for n=1:length(dtests)
    if exist(dtests{n}.objective_resultfile, 'file') == 0;   
        [ objdata, test_runtime ] = obj_evaluation(BLIZZARD2009_RESULTDIR, dtests{n}.reffilelist,dtests{n}.testfilelist, mapmethods);
        save(dtests{n}.objective_resultfile, 'objdata','-ascii');                      
        dtests{n}.results=objdata;
    else      
        dtests{n}.results=load(dtests{n}.objective_resultfile);
    end
    dtests{n}.scores=evaluate_wilcoxon(dtests{n}.results, load(dtests{n}.subjective_resultfile), load(dtests{n}.opinionmatrix), ...
                               dtests{n}.systems, 0);
end

