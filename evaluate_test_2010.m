%
% Evaluate our tests2010 sets for 2010
%

local_conf

mapmethods={ {'fft','snr'},...
             {'straight','snr'},...
             {'fft','mcd'}, ...
             {'straight','mcd'}, ...
             {'llr','llr'}};

gaussmethods= { { 'straight', 'log-mel' }, ...
                { 'fft', 'log-mel'} };

gausscomps=[10,30,50];        

% How many tests2010 do we do?

testcount=length(mapmethods)^2 + length(gaussmethods)*length(gausscomps);

% Make a list of file pair distances, initialise to zero:

testlist=cell(testcount,1);

ind=1
for y=1:length(mapmethods)

     spec_and_distmethod=mapmethods{y};
     mapspec=spec_and_distmethod{1};
     mapdist=spec_and_distmethod{2};
     
     for z=1:length(mapmethods) 

       spec_and_distmethod=mapmethods{z};
       pathspec=spec_and_distmethod{1};
       pathdist=spec_and_distmethod{2}; 
       
       testlist{ind} = ...
           ['map: ',mapspec,'-',mapdist,', path:',pathspec,'-',pathdist];
       ind=ind+1;
     end   
end
for y=1:length(gaussmethods)
     spec_and_distmethod=gaussmethods{y};
     featspec=spec_and_distmethod{1};
     featdist=spec_and_distmethod{2};
    
     for z=1:length(gausscomps)
        testlist{ind} =...
            ['feat: ',featspec,'-',featdist,', gausscomp:',num2str(gausscomps(z))];
        ind=ind+1;
     end
end

disp(testlist)


if (matlabpool('size') == 0)
    matlabpool
end

tests2010={ ...
    struct( ...  
        'name',                  'EH1_similarity',...
        'objective_resultfile',  'tests/2010/2010_EH1_objective_results_sim',...
        'testfilelist',          'tests/2010/2010_EH1_sim.test.scp',...
        'reffilelist',           'tests/2010/2010_EH1_sim.ref.scp',...
        'subjective_resultfile', 'tests/2010/2010_EH1_sim_mean.ascii',...
        'opinionmatrix',         'tests/2010/significancematrix_2010_EH1_sim.ascii',...
        'systems',               'BCFGHJLMNOPQRSTUV', ...
        'sentencesperspeaker',    18, ...
        'scores',                [], ...
        'results',                []), ... 
    struct( ...  
        'name',                  'EH1_naturalness',...
        'objective_resultfile',  'tests/2010/2010_EH1_objective_results_nat',...
        'testfilelist',          'tests/2010/2010_EH1_nat.test.scp',...
        'reffilelist',           'tests/2010/2010_EH1_nat.ref.scp',...
        'subjective_resultfile', 'tests/2010/2010_EH1_nat_mean.ascii',...
        'opinionmatrix',         'tests/2010/significancematrix_2010_EH1_nat.ascii',...
        'systems',               'BCFGHJLMNOPQRSTUV', ...
        'sentencesperspeaker',    36, ...
        'scores',                [], ...
        'results',                []), ... 
    struct( ...       
        'name',                  'EH2_similarity',...
        'objective_resultfile',  'tests/2010/2010_EH2_objective_results_sim',...
        'testfilelist',          'tests/2010/2010_EH2_sim.test.scp',...
        'reffilelist',           'tests/2010/2010_EH2_sim.ref.scp',...
        'subjective_resultfile', 'tests/2010/2010_EH2_sim_mean.ascii',...
        'opinionmatrix',         'tests/2010/significancematrix_2010_EH2_sim.ascii',...
        'systems',               'BCDGHJKLMNOPQRSUV', ...
        'sentencesperspeaker',    18, ...
        'scores',                [], ...
        'results',                []), ... 
    struct( ...  
        'name',                  'EH2_naturalness',...
        'objective_resultfile',  'tests/2010/2010_EH2_objective_results_nat',...
        'testfilelist',          'tests/2010/2010_EH2_nat.test.scp',...
        'reffilelist',           'tests/2010/2010_EH2_nat.ref.scp',...
        'subjective_resultfile', 'tests/2010/2010_EH2_nat_mean.ascii',...
        'opinionmatrix',         'tests/2010/significancematrix_2010_EH2_nat.ascii',...
        'systems',               'BCDGHJKLMNOPQRSUV', ...
        'sentencesperspeaker',    36, ...
        'scores',                [], ...
        'results',                []), ...                     
    struct( ...  
        'name',                  'ES1_similarity',...
        'objective_resultfile',  'tests/2010/2010_ES1_objective_results_sim',...
        'testfilelist',          'tests/2010/2010_ES1_sim.test.scp',...
        'reffilelist',           'tests/2010/2010_ES1_sim.ref.scp',...
        'subjective_resultfile', 'tests/2010/2010_ES1_sim_mean.ascii',...
        'opinionmatrix',         'tests/2010/significancematrix_2010_ES1_sim.ascii',...
        'systems',               'CEMNQRV', ...
        'sentencesperspeaker',    16, ...
        'scores',                [], ...
        'results',                []), ...     
    struct( ...  
        'name',                  'ES1_naturalness',...
        'objective_resultfile',  'tests/2010/2010_ES1_objective_results_nat',...
        'testfilelist',          'tests/2010/2010_ES1_nat.test.scp',...
        'reffilelist',           'tests/2010/2010_ES1_nat.ref.scp',...
        'subjective_resultfile', 'tests/2010/2010_ES1_nat_mean.ascii',...
        'opinionmatrix',         'tests/2010/significancematrix_2010_ES1_nat.ascii',...        
        'systems',               'CEMNQRV', ...
        'sentencesperspeaker',    16, ...
          'scores',                [], ...
          'results',                []), ...     
...%      struct( ...  
...%        'name',                  'ES2_similarity',...
...%        'objective_resultfile',  'tests/2010/2010_ES2_objective_results_sim',...
...%        'testfilelist',          'tests/2010/2010_ES2_sim.test.scp',...
...%        'reffilelist',           'tests/2010/2010_ES2_sim.ref.scp',...
...%        'subjective_resultfile', 'tests/2010/2010_ES2_sim_mean.ascii',...
...%        'opinionmatrix',         'tests/2010/significancematrix_2010_ES2_sim.ascii',...
...%        'systems',               'DHJLPSW', ...
...%        'sentencesperspeaker',    16, ...
...%        'scores',                [], ...
...%        'results',                []), ...     
...%    struct( ...  
...%        'name',                  'ES2_naturalness',...
...%        'objective_resultfile',  'tests/2010/2010_ES2_objective_results_nat',...
...%        'testfilelist',          'tests/2010/2010_ES2_nat.test.scp',...
...%        'reffilelist',           'tests/2010/2010_ES2_nat.ref.scp',...
...%        'subjective_resultfile', 'tests/2010/2010_ES2_nat_mean.ascii',...
...%        'opinionmatrix',         'tests/2010/significancematrix_2010_ES2_nat.ascii',...        
...%        'systems',               'DHJLPSW', ...
...%        'sentencesperspeaker',    16, ...
...%          'scores',                [], ...
...%          'results',                []), ...                 
    struct( ...  
        'name',                  'ES3_naturalness',...
        'objective_resultfile',  'tests/2010/2010_ES3_objective_results_nat',...
        'testfilelist',          'tests/2010/2010_ES3_nat.test.scp',...
        'reffilelist',           'tests/2010/2010_ES3_nat.ref.scp',...
        'subjective_resultfile', 'tests/2010/2010_ES3_nat_mean.ascii',...
        'opinionmatrix',         'tests/2010/significancematrix_2010_ES3_nat.ascii',...        
        'systems',               'CHMPRSV', ...
        'sentencesperspeaker',    16, ...
          'scores',                [], ...
          'results',                []), ...       
      struct( ...  
        'name',                  'ES3_similarity',...
        'objective_resultfile',  'tests/2010/2010_ES3_objective_results_sim',...
        'testfilelist',          'tests/2010/2010_ES3_sim.test.scp',...
        'reffilelist',           'tests/2010/2010_ES3_sim.ref.scp',...
        'subjective_resultfile', 'tests/2010/2010_ES3_sim_mean.ascii',...
        'opinionmatrix',         'tests/2010/significancematrix_2010_ES3_sim.ascii',...
        'systems',               'CHMPRSV', ...
        'sentencesperspeaker',    16, ...
        'scores',                [], ...
        'results',                []), ...     
   struct( ...  
        'name',                  'MH1_similarity',...
        'objective_resultfile',  'tests/2010/2010_MH1_objective_results_sim',...
        'testfilelist',          'tests/2010/2010_MH1_sim.test.scp',...
        'reffilelist',           'tests/2010/2010_MH1_sim.ref.scp',...
        'subjective_resultfile', 'tests/2010/2010_MH1_sim_mean.ascii',...
        'opinionmatrix',         'tests/2010/significancematrix_2010_MH1_sim.ascii',...        
        'systems',               'CHIJKLNPQRS', ...
        'sentencesperspeaker',    12, ...
          'scores',                [], ...
          'results',                []), ...     
    struct( ...
        'name',                  'MH1_naturalness',...
        'objective_resultfile',  'tests/2010/2010_MH1_objective_results_nat',...
        'testfilelist',          'tests/2010/2010_MH1_nat.test.scp',...
        'reffilelist',           'tests/2010/2010_MH1_nat.ref.scp',...
        'subjective_resultfile', 'tests/2010/2010_MH1_nat_mean.ascii',...
        'opinionmatrix',         'tests/2010/significancematrix_2010_MH1_nat.ascii',...                
        'systems',               'CHIJKLNPQRS', ...
        'sentencesperspeaker',    24, ...
          'scores',                [], ...
          'results',                []), ...     
  struct( ...  
        'name',                  'MH2_similarity',...
        'objective_resultfile',  'tests/2010/2010_MH2_objective_results_sim',...
        'testfilelist',          'tests/2010/2010_MH2_sim.test.scp',...
        'reffilelist',           'tests/2010/2010_MH2_sim.ref.scp',...
        'subjective_resultfile', 'tests/2010/2010_MH2_sim_mean.ascii',...
        'opinionmatrix',         'tests/2010/significancematrix_2010_MH2_sim.ascii',...        
        'systems',               'CHIJLNPQRS', ...
        'sentencesperspeaker',    11, ...
          'scores',                [], ...
          'results',                []), ...     
    struct( ...
        'name',                  'MH2_naturalness',...
        'objective_resultfile',  'tests/2010/2010_MH2_objective_results_nat',...
        'testfilelist',          'tests/2010/2010_MH2_nat.test.scp',...
        'reffilelist',           'tests/2010/2010_MH2_nat.ref.scp',...
        'subjective_resultfile', 'tests/2010/2010_MH2_nat_mean.ascii',...
        'opinionmatrix',         'tests/2010/significancematrix_2010_MH2_nat.ascii',...                
        'systems',               'CHIJLNPQRS', ...
        'sentencesperspeaker',    22, ...
          'scores',                [], ...
          'results',                []), ...                                  
    struct( ...
        'name',                  'MS1_similarity',...
        'objective_resultfile',  'tests/2010/2010_MS1_objective_results_sim',...
        'testfilelist',          'tests/2010/2010_MS1_sim.test.scp',...
        'reffilelist',           'tests/2010/2010_MS1_sim.ref.scp',...
        'subjective_resultfile', 'tests/2010/2010_MS1_sim_mean.ascii',...
        'opinionmatrix',         'tests/2010/significancematrix_2010_MS1_sim.ascii',...
        'systems',               'CHIRS', ...
        'sentencesperspeaker',    12, ...
          'scores',                [], ...
          'results',                []), ...     
    struct( ...
        'name',                  'MS1_naturalness',...
        'objective_resultfile',  'tests/2010/2010_MS1_objective_results_nat',...
        'testfilelist',          'tests/2010/2010_MS1_nat.test.scp',...
        'reffilelist',           'tests/2010/2010_MS1_nat.ref.scp',...
        'subjective_resultfile', 'tests/2010/2010_MS1_nat_mean.ascii',...
        'opinionmatrix',         'tests/2010/significancematrix_2010_MS1_nat.ascii',...
        'systems',               'CHIRS', ...
        'sentencesperspeaker',    12, ...
          'scores',                [], ...
          'results',                []), ... 
...%    struct( ...
...%        'name',                  'MS2_similarity',...
...%        'objective_resultfile',  'tests/2010/2010_MS2_objective_results_sim',...
...%        'testfilelist',          'tests/2010/2010_MS2_sim.test.scp',...
...%        'reffilelist',           'tests/2010/2010_MS2_sim.ref.scp',...
...%        'subjective_resultfile', 'tests/2010/2010_MS2_sim_mean.ascii',...
...%        'opinionmatrix',         'tests/2010/significancematrix_2010_MS2_sim.ascii',...
...%        'systems',               'DLMRVW', ...
...%        'sentencesperspeaker',    13, ...
...%          'scores',                [], ...
...%          'results',                []), ...     
...%    struct( ...
...%        'name',                  'MS2_naturalness',...
...%        'objective_resultfile',  'tests/2010/2010_MS2_objective_results_nat',...
...%        'testfilelist',          'tests/2010/2010_MS2_nat.test.scp',...
...%        'reffilelist',           'tests/2010/2010_MS2_nat.ref.scp',...
...%        'subjective_resultfile', 'tests/2010/2010_MS2_nat_mean.ascii',...
...%        'opinionmatrix',         'tests/2010/significancematrix_2010_MS2_nat.ascii',...
...%        'systems',               'DLMRVW', ...
...%        'sentencesperspeaker',    13, ...
...%          'scores',                [], ...
...%          'results',                []), ...             
      };


    
for n=1:length(tests2010)
    if exist(tests2010{n}.objective_resultfile, 'file') == 0;   
        [ objdata, test_runtime, testlist] = obj_evaluation(BLIZZARD2010_RESULTDIR, tests2010{n}.reffilelist,tests2010{n}.testfilelist,...
            mapmethods,  gaussmethods, gausscomps, tests2010{n}.sentencesperspeaker);
        save(tests2010{n}.objective_resultfile, 'objdata','-ascii');
        tests2010{n}.results=objdata;
    else      
        disp(['Loading results from ',tests2010{n}.objective_resultfile])
        tests2010{n}.results=load(tests2010{n}.objective_resultfile);
        
    end
    
    tests2010{n}.scores=evaluate_wilcoxon(tests2010{n}.results, load(tests2010{n}.subjective_resultfile), load(tests2010{n}.opinionmatrix), ...
                               tests2010{n}.systems, 0);
end

